{% extends "base.html" %}

{% block title %}Saved Recipes{% endblock %}

{% block content %}
<h1>Your Saved Recipes</h1>

{% if saved_recipes or made_recipes %}
    <div class="grid">
        <!-- Saved recipes -->
        {% for recipe in saved_recipes %}
        <div class="recipe-card" id="recipe-{{ recipe.recipe_id }}">
            <img src="{{ recipe.image }}" alt="{{ recipe.name }}">
            <h2 class="recipe-title">{{ recipe.name }}</h2>
            <p><strong>Source:</strong> {{ recipe.source }}</p>
            <p><a href="{{ recipe.url }}" target="_blank">View Full Recipe</a></p>
            <form action="{{ url_for('unsave_recipe') }}" method="post">
                <input type="hidden" name="recipe_id" value="{{ recipe.recipe_id }}">
                <button type="submit" class="remove-btn">Remove</button>
            </form>
            <button type="button" class="mark-made-btn" onclick="markAsMade(this.closest('.recipe-card'))">
                I made this
            </button>
        </div>
        {% endfor %}

        <!-- Made recipes -->
        {% for recipe in made_recipes %}
        <div class="recipe-card made" id="made-recipe-{{ recipe.recipe_id }}">
            <img src="{{ recipe.image }}" alt="{{ recipe.name }}">
            <h2 class="recipe-title">{{ recipe.name }}</h2>
            <p><strong>Source:</strong> {{ recipe.source }}</p>
            <p><a href="{{ recipe.url }}" target="_blank">View Full Recipe</a></p>
            <p><strong>Status:</strong> You've made this!</p>
            <form action="{{ url_for('unsave_made_recipe') }}" method="post">
                <input type="hidden" name="recipe_id" value="{{ recipe.recipe_id }}">
                <button type="submit" class="remove-btn">Remove</button>
            </form>
        </div>
        {% endfor %}
    </div>
{% else %}
    <p>You have no saved recipes.</p>
{% endif %}

<script>
    function markAsMade(cardElement) {
        cardElement.classList.add("made");
        const button = cardElement.querySelector(".mark-made-btn");
        button.textContent = "You've made this!";
        button.disabled = true;
        button.style.cursor = "default";

        const recipeId = cardElement.id.split("-")[1];
        fetch("/made_recipe", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ recipe_id: recipeId }),
        }).catch((error) => {
            console.error("Error updating recipe as made:", error);
        });
    }
</script>
{% endblock %}
